(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a7c88acc"],{"1b44":function(e,t,a){},"3f5e":function(e,t,a){"use strict";a.d(t,"a",(function(){return l})),a.d(t,"b",(function(){return s}));var i=a("b775");function l(e){return i["a"].delete("/file/delete",{params:e})}function s(e){return i["a"].get("/file/page",{params:e})}},"4fa9":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"container"},[a("div",{staticClass:"head"},[a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-upload"},on:{click:function(t){e.visible=!0}}},[e._v("upload")])],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,border:""}},[a("el-table-column",{attrs:{prop:"name",label:"名称",width:"270",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"url",label:"链接",width:"520",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{prop:"date",label:"时间",width:"180",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:t.row.url,expression:"scope.row.url",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.copySuccess,expression:"copySuccess",arg:"success"}],attrs:{size:"mini",type:"success"}},[e._v("复制链接")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),a("div",{staticClass:"btn-group"},[a("el-button",{attrs:{size:"mini",type:"primary",disabled:1===e.pageNum},on:{click:e.prevClick}},[e._v("上一页")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary",disabled:e.loadedAll},on:{click:e.nextClick}},[e._v("下一页")])],1),e._v(" "),a("img-upload",{attrs:{visible:e.visible},on:{dialogClose:e.dialogClose,uploadSuccess:e.uploadSuccess}})],1)},l=[],s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{modal:!1,title:"上传图片",top:"35vh",visible:e.visible,width:"350px","before-close":e.dialogClose,"lock-scroll":!1},on:{"update:visible":function(t){e.visible=t}}},[a("div",{staticStyle:{"text-align":"center"}},[a("el-upload",{ref:"upload",attrs:{action:e.path,"file-list":e.files,multiple:!1,limit:1,headers:e.headers,"auto-upload":!1,name:"file","on-exceed":e.onExceed,"before-upload":e.beforeUpload,"on-success":e.uploadSuccess,"on-error":e.uploadError}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary",disabled:e.loading},slot:"trigger"},[e._v("选取文件")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"success",disabled:e.loading},on:{click:function(){e.$refs.upload.submit()}}},[e._v("上传文件")]),e._v(" "),a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpeg/jpg/png文件，且不超过500kb")])],1)],1)])},n=[],o=a("5f87"),r={props:{visible:{type:Boolean,default:!1}},data:function(){return{path:"http://localhost:8080//file/upload",files:[],loading:!1}},computed:{headers:function(){var e={Authorization:"Bearer "+Object(o["a"])()};return e}},methods:{onExceed:function(){this.loading=!1},uploadSuccess:function(e,t,a){if(0!==e.code)return console.error(e.message),void this.$message.error("文件上传失败");this.$emit("uploadSuccess",e.data),this.loading=!1},uploadError:function(e){console.error(e),this.loading=!1,this.$message.error("文件上传失败")},beforeUpload:function(e){this.loading=!0;var t="image/jpeg"===e.type||"image/png"===e.type||"image/jpg"===e.type,a=e.size/1e3<500;return t||(this.$message.error("文件格式不正确"),this.loading=!1),a||(this.$message.error("文件大小不能大于500KB"),this.loading=!1),t&&a},dialogClose:function(){this.files=[],this.loading=!1,this.$emit("dialogClose")}}},c=r,u=a("2877"),d=Object(u["a"])(c,s,n,!1,null,null,null),p=d.exports,g=a("3f5e"),m={name:"FileManage",components:{ImgUpload:p},data:function(){return{visible:!1,tableData:[],markers:[null],pageNum:1,pageSize:10,loadedAll:!1,loading:!0}},mounted:function(){var e={size:this.pageSize,marker:null};this.init(e)},methods:{init:function(e){var t=this;this.loading=!0,Object(g["b"])(e).then((function(e){t.loading=!1,t.tableData=e.data.records,t.markers.push(e.data.nextMarker),t.loadedAll=e.data.loadedAll}),(function(e){console.error(e),t.loading=!1}))},nextClick:function(){var e=this;this.loading=!0;var t={size:this.pageSize,marker:this.markers[this.pageNum]};Object(g["b"])(t).then((function(t){e.loading=!1,e.tableData=t.data.records;var a=t.data.nextMarker;-1===e.markers.indexOf(a)&&e.markers.push(a),e.pageNum=e.pageNum+1,e.loadedAll=t.data.loadedAll}),(function(t){console.error(t),e.loading=!1}))},prevClick:function(){var e=this;this.loading=!0;var t={size:this.pageSize,marker:this.markers[this.pageNum-2]};Object(g["b"])(t).then((function(t){e.loading=!1,e.tableData=t.data.records;var a=t.data.nextMarker;-1===e.markers.indexOf(a)&&e.markers.push(a),e.pageNum=e.pageNum-1,e.loadedAll=t.data.loadedAll}),(function(t){console.error(t),e.loading=!1}))},copySuccess:function(){this.$message({message:"复制链接成功",type:"success"})},handleDelete:function(e){var t=this;this.$confirm("确定删除该文件吗","提示",{confirmButtonText:"确定",cancelButtonText:"取消",showClose:!1,type:"warning"}).then((function(){var a={fullPath:e.url};Object(g["a"])(a).then((function(e){t.$message({message:"删除成功",type:"success"}),t.markers=[null],t.pageNum=1,t.init()}))})).catch((function(){}))},uploadSuccess:function(){this.visible=!1,this.$message({message:"上传成功",type:"success"}),this.markers=[null],this.pageNum=1,this.init()},dialogClose:function(){this.visible=!1}}},f=m,h=(a("6c6e"),Object(u["a"])(f,i,l,!1,null,"1df4f36c",null));t["default"]=h.exports},"6c6e":function(e,t,a){"use strict";var i=a("1b44"),l=a.n(i);l.a}}]);