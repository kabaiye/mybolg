(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-e26ab190"],{"1d11":function(t,e,i){"use strict";i.r(e);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{ref:"container",staticClass:"container"},[i("app-header",{attrs:{"nav-item-active":4}}),t._v(" "),i("div",{staticClass:"content-container"},[i("div",{staticClass:"content-head"},[i("p",{staticClass:"main-tip-label"},[t._v("温馨提示")]),t._v(" "),t._m(0),t._v(" "),i("div",{staticClass:"edit-container"},[i("quill-editor",{ref:"editor",attrs:{options:t.editorOption},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),t._v(" "),i("div",{staticClass:"main-tools-box"},[i("el-button",{attrs:{loading:t.cloading,type:"danger",size:"mini"},on:{click:t.messageSubmit}},[t._v("留个言")])],1)]),t._v(" "),i("div",{staticClass:"content-box"},[i("p",{staticClass:"main-tip-label"},[t._v("留言列表\n        "),i("span",{staticClass:"right"},[t._v("共"+t._s(t.total)+"条留言")])]),t._v(" "),i("ul",{staticClass:"content-list"},[i("transition-group",{attrs:{name:"fade-list"}},t._l(t.commentList,(function(e,s){return i("li",{key:s,staticClass:"list-item"},[i("div",{staticClass:"cmt-li-title"},[i("div",{staticClass:"headimg"},[i("img",{attrs:{src:e.fromUser.avatar||t.defaultAvatar}})])]),t._v(" "),i("div",{staticClass:"cmt-li-r"},[i("div",{staticClass:"top"},[i("p",{staticClass:"nickname",style:1===e.fromUser.admin?"color:#e74851":""},[t._v("\n                  "+t._s(e.fromUser.nickname)+"\n\n                  "),1===e.fromUser.admin?i("el-tag",{attrs:{type:"info",size:"mini",effect:"light"}},[t._v("狗管理")]):t._e()],1),t._v(" "),i("p",{staticClass:"date"},[t._v(t._s(t.parseDate(e.createTime))+"留言")])]),t._v(" "),i("p",{staticClass:"body-text",domProps:{innerHTML:t._s(e.content)}}),t._v(" "),i("div",{staticClass:"btns-bar"},[t.userInfo&&(t.userInfo.id===e.fromUser.id||t.userInfo.roles.includes("admin"))?i("el-popover",{attrs:{placement:"bottom"},model:{value:e.del_visible,callback:function(i){t.$set(e,"del_visible",i)},expression:"comment.del_visible"}},[i("p",{staticStyle:{margin:"8px"}},[t._v("确定删除这一条留言吗？")]),t._v(" "),i("div",{staticStyle:{"text-align":"right",margin:"0"}},[i("el-button",{staticStyle:{color:"#999","font-size":"12px"},attrs:{size:"mini",type:"text"},on:{click:function(t){e.del_visible=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{staticStyle:{"font-size":"12px"},attrs:{type:"text",size:"mini"},on:{click:function(i){return t.delSubmit(e)}}},[t._v("确定")])],1),t._v(" "),i("span",{staticClass:"reply-btn",attrs:{slot:"reference"},slot:"reference"},[t._v("删除")])]):t._e(),t._v(" "),i("span",{staticClass:"reply-btn",on:{click:function(i){return t.reClick(e.id,e.fromUser.id)}}},[t._v("回复")])],1),t._v(" "),i("ul",{staticClass:"reply-list"},t._l(e.replyList,(function(s,n){return i("li",{key:n,staticClass:"reply-item"},[i("div",{staticClass:"reply-date"},[t._v(t._s(t.parseDate(s.createTime))+"回复")]),t._v(" "),i("div",{staticClass:"reply-content"},[i("div",{staticClass:"headimg"},[i("img",{attrs:{src:s.fromUser.avatar||t.defaultAvatar}})]),t._v(" "),i("div",{staticClass:"nickname"},[i("span",{style:1===s.fromUser.admin?"color:#e74851":""},[t._v(t._s(s.fromUser.nickname))]),t._v(" "),i("span",{staticStyle:{color:"#000000"}},[t._v("回复")]),t._v(" "),i("span",{style:1===s.toUser.admin?"color:#e74851":""},[t._v("@"+t._s(s.toUser.nickname))])]),t._v(" "),i("p",{staticClass:"reply-text",domProps:{innerHTML:t._s(s.content)}})]),t._v(" "),i("div",{staticClass:"btns-bar"},[t.userInfo&&(t.userInfo.id===s.fromUser.id||t.userInfo.roles.includes("admin"))?i("el-popover",{attrs:{placement:"bottom"},model:{value:s.del_visible,callback:function(e){t.$set(s,"del_visible",e)},expression:"reply.del_visible"}},[i("p",{staticStyle:{margin:"8px"}},[t._v("确定删除这一条回复吗？")]),t._v(" "),i("div",{staticStyle:{"text-align":"right",margin:"0"}},[i("el-button",{staticStyle:{color:"#999","font-size":"12px"},attrs:{size:"mini",type:"text"},on:{click:function(t){s.del_visible=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{staticStyle:{"font-size":"12px"},attrs:{type:"text",size:"mini"},on:{click:function(e){return t.delSubmit(s)}}},[t._v("确定")])],1),t._v(" "),i("span",{staticClass:"reply-btn",attrs:{slot:"reference"},slot:"reference"},[t._v("删除")])]):t._e(),t._v(" "),i("span",{staticClass:"reply-btn",on:{click:function(i){return t.reClick(e.id,s.fromUser.id)}}},[t._v("回复")])],1)])})),0)])])})),0)],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:1===t.current&&t.loading,expression:"current === 1 && loading"},{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{color:"#fff",width:"100%",height:"100px"},attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"#fff"}},[t._v("正在加载")])])]),t._v(" "),i("el-pagination",{attrs:{background:"",layout:"prev, pager, next","page-size":t.size,"current-page":t.current,total:t.total},on:{"current-change":t.currentChange}}),t._v(" "),i("el-dialog",{staticClass:"rely-dialog",attrs:{visible:t.reEditVisible,title:"提示",width:"desktop"===t.device?"700px":"95%",top:"45vh",modal:!1,"show-close":!1,"before-close":t.bClose},on:{"update:visible":function(e){t.reEditVisible=e}}},[i("div",{staticClass:"re-editor-container"},[i("quill-editor",{attrs:{options:t.reEditorOption},model:{value:t.recontent,callback:function(e){t.recontent=e},expression:"recontent"}})],1),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"info",size:"mini"},on:{click:t.bClose}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{loading:t.rloading,type:"danger",size:"mini"},on:{click:t.reSubmit}},[t._v("确 定")])],1)])],1)},n=[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("p",{staticClass:"main-tip-text"},[t._v("\n        本站欢迎交换友链，请在下面留言备注即可，请先在您博客上添加本站的友链。\n        "),i("span",{attrs:{"data-name":"kissing_heart"}},[i("span",{attrs:{contenteditable:"false"}},[i("span",{staticClass:"ap ap-kissing_heart"},[t._v("?\n          ")])])])])}],a=(i("a481"),i("db72")),o=i("5880"),r=i("ed08"),l=(i("5408"),i("981c")),c=i("b775");function d(t){return c["a"].get("/leave/message/page",{params:t})}function u(t){return Object(c["a"])({url:"/leave/message/add",method:"post",params:t})}function m(t){return Object(c["a"])({url:"/leave/message/reply",method:"post",params:t})}function p(t){return c["a"].delete("/leave/message/delete/"+t)}var v={name:"Message",components:{AppHeader:l["a"]},data:function(){return{content:"",recontent:"",loading:!1,editorOption:{modules:{toolbar:{container:[["emoji"]]},"emoji-toolbar":!0,"emoji-shortname":!0},placeholder:"客官，来都来了，怎么不给博主留个言呢 ？"},reEditVisible:!1,reEditorOption:{modules:{toolbar:{container:[["emoji"]]},"emoji-toolbar":!0,"emoji-shortname":!0},placeholder:"回复点啥子呢？"},current:1,size:10,total:0,commentList:[],pid:0,toUserId:0,cloading:!1,rloading:!1}},computed:Object(a["a"])({},Object(o["mapGetters"])(["userInfo","defaultAvatar","device"])),mounted:function(){this.pageMessage()},methods:{parseDate:function(t){return t=t.replace(/\-/g,"/"),Object(r["b"])(new Date(t))},bClose:function(){this.pid=0,this.toUserId=0,this.reEditVisible=!1,this.recontent=""},currentChange:function(t){this.current=t,this.pageMessage()},pageMessage:function(){var t=this;this.loading=!0;var e={current:this.current,size:this.size};d(e).then((function(e){t.loading=!1,t.total=e.data.total;for(var i=e.data.records,s=i.length,n=0;n<s;n++){i[n].del_visible=!1;for(var a=i[n].replyList,o=a.length,r=0;r<o;r++)a[r].del_visible=!1}t.commentList=i,t.$refs.container.scrollTop=0}),(function(e){console.error(e),t.loading=!1}))},reload:function(){this.current=1,this.pageMessage()},messageSubmit:function(){var t=this,e=this.userInfo;if(e){var i=this.content.replace(/<\/?p[^>]*>/gi,"");if(i){var s={content:i},n=e.email;n?(this.cloading=!0,u(s).then((function(e){t.cloading=!1,t.$message({message:"留言成功",type:"success"}),t.content="",t.reload()}),(function(e){console.log(e),t.cloading=!1}))):this.$confirm("没绑定邮箱接收不到回复提醒哦~","提示",{confirmButtonText:"马上绑定",cancelButtonText:"下次一定",showClose:!1,type:"warning"}).then((function(){t.$router.push("/email-validate")})).catch((function(){t.cloading=!0,u(s).then((function(e){t.cloading=!1,t.$message({message:"留言成功",type:"success"}),t.content="",t.reload()}),(function(e){console.log(e),t.cloading=!1}))}))}else this.$message("还没输入内容呢~")}else this.$store.commit("login/CHANGE_VISIBLE",!0)},delSubmit:function(t){var e=this;p(t.id).then((function(t){e.$message({message:"删除成功",type:"success"}),e.reload()}))},reClick:function(t,e){var i=this.userInfo;i?(this.reEditVisible=!0,this.pid=t,this.toUserId=e):this.$store.commit("login/CHANGE_VISIBLE",!0)},reSubmit:function(){var t=this,e=this.recontent.replace(/<\/?p[^>]*>/gi,"");if(e){var i={pid:this.pid,toUserId:this.toUserId,content:e},s=this.userInfo.email;s?(this.rloading=!0,m(i).then((function(e){t.rloading=!1,t.reEditVisible=!1,t.recontent="",t.$message({message:"回复成功",type:"success"}),t.reload()}),(function(e){console.error(e),t.rloading=!1}))):this.$confirm("没绑定邮箱接收不到回复提醒哦~","提示",{confirmButtonText:"马上绑定",cancelButtonText:"下次一定",showClose:!1,type:"warning"}).then((function(){t.$router.push("/email-validate")})).catch((function(){t.rloading=!0,m(i).then((function(e){t.rloading=!1,t.reEditVisible=!1,t.recontent="",t.$message({message:"回复成功",type:"success"}),t.reload()}),(function(e){console.error(e),t.rloading=!1}))}))}else this.$message("还没输入内容呢~")}}},f=v,g=(i("ac68"),i("fece"),i("2877")),_=Object(g["a"])(f,s,n,!1,null,"61dee2ca",null);e["default"]=_.exports},"3cc0":function(t,e,i){},"5c23":function(t,e,i){},ac68:function(t,e,i){"use strict";var s=i("5c23"),n=i.n(s);n.a},fece:function(t,e,i){"use strict";var s=i("3cc0"),n=i.n(s);n.a}}]);